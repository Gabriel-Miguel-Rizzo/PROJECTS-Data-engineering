USE [db_views]
GO
/****** Object:  StoredProcedure [dbo].[BI_PLANILHA_VTEX_PROD_COR]    Script Date: 02/07/2024 15:18:59 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[BI_PLANILHA_VTEX_PROD_COR] AS

BEGIN

TRUNCATE TABLE CARGA_PLANILHA_VTEX;
TRUNCATE TABLE PLANILHA_VTEX_PROD_COR;
INSERT INTO CARGA_PLANILHA_VTEX
SELECT
CREATION_DATE, STATUSS, REFERENCE_CODE, SKU_VALUE, SKU_SELLING_PRICE, SKU_TOTAL_PRICE, SELLER_NAME

FROM OPENROWSET('Microsoft.ACE.OLEDB.12.0', 
                'Excel 12.0;Database=G:\API VTEX\PLANILHA_VTEX_SACADA.xlsx;HDR=YES', 
                'SELECT CREATION_DATE, STATUSS AS STATUSS, REFERENCE_CODE, SKU_VALUE, SKU_SELLING_PRICE, SKU_TOTAL_PRICE, SELLER_NAME
				 FROM [Sheet1$]');


INSERT INTO CARGA_PLANILHA_VTEX
SELECT
CREATION_DATE, STATUSS, REFERENCE_CODE, SKU_VALUE, SKU_SELLING_PRICE, SKU_TOTAL_PRICE, UPPER(SELLER_NAME) AS SELLER_NAME

FROM OPENROWSET('Microsoft.ACE.OLEDB.12.0', 
                'Excel 12.0;Database=G:\API VTEX\PLANILHA_VTEX_OHBOY.xlsx;HDR=YES', 
                'SELECT CREATION_DATE, STATUSS AS STATUSS, REFERENCE_CODE, SKU_VALUE, SKU_SELLING_PRICE, SKU_TOTAL_PRICE, SELLER_NAME
				 FROM [Sheet1$]');


INSERT INTO PLANILHA_VTEX_PROD_COR
SELECT C.CREATION_DATE,
       C.STATUS,
       C.REFERENCE_CODE,
	   LEFT(C.REFERENCE_CODE,8) AS PRODUTO,
	   RIGHT(LEFT(C.REFERENCE_CODE,13),4) AS COR ,
	   REPLACE(RIGHT(C.REFERENCE_CODE,2),'_','') AS TAMANHO,
       C.SKU_VALUE, 
	   C.SKU_SELLING_PRICE,
	   C.SKU_TOTAL_PRICE,
	   C.SELLER_NAME
FROM CARGA_PLANILHA_VTEX C


END
